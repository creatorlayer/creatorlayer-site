openapi: 3.0.0
info:
  title: Creatorlayer API
  version: 1.0.0

servers:
  - url: https://api.creatorlayer.eu
  - url: http://localhost:3000

paths:
  /health:
    get:
      summary: Health check endpoint
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
              example:
                status: ok

  /api/v1/creators/{id}:
    get:
      summary: Get a creator by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Creator found
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Creator'
                  - type: object
                    properties:
                      latest_verification:
                        allOf:
                          - $ref: '#/components/schemas/CreatorVerification'
                        nullable: true
              example:
                id: 1
                youtube_channel: "https://youtube.com/@example"
                twitch_channel: null
                created_at: "2026-02-18T12:00:00Z"
                latest_verification:
                  id: 10
                  creator_id: 1
                  creator_youtube_channel: "https://youtube.com/@example"
                  creator_twitch_channel: null
                  income_30d: 1200.5
                  income_90d: 3500.75
                  trend: growing
                  risk_score: 0.02
                  recommended_loan_amount: 4000
                  fraud_flags: []
                  lender_ref: "LENDER-001"
                  created_at: "2026-02-18T12:00:00Z"
        '404':
          description: Creator not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Creator not found"

  /api/v1/creator_verifications/{id}:
    get:
      summary: Get a creator verification by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Creator verification found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreatorVerification'
              example:
                id: 10
                creator_id: 1
                creator_youtube_channel: "https://youtube.com/@example"
                creator_twitch_channel: null
                income_30d: 1200.5
                income_90d: 3500.75
                trend: growing
                risk_score: 0.02
                recommended_loan_amount: 4000
                fraud_flags: []
                lender_ref: "LENDER-001"
                created_at: "2026-02-18T12:00:00Z"
        '404':
          description: Creator verification not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "Creator verification not found"

  /api/v1/creators/{id}/verifications:
    get:
      summary: Get all verifications for a creator
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: List of verifications
          content:
            application/json:
              schema:
                type: object
                properties:
                  creator_id:
                    type: integer
                  verifications:
                    type: array
                    items:
                      $ref: '#/components/schemas/CreatorVerification'
              example:
                creator_id: 1
                verifications:
                  - id: 10
                    creator_id: 1
                    creator_youtube_channel: "https://youtube.com/@example"
                    creator_twitch_channel: null
                    income_30d: 1200.5
                    income_90d: 3500.75
                    trend: growing
                    risk_score: 0.02
                    recommended_loan_amount: 4000
                    fraud_flags: []
                    lender_ref: "LENDER-001"
                    created_at: "2026-02-18T12:00:00Z"
                  - id: 11
                    creator_id: 1
                    creator_youtube_channel: "https://youtube.com/@example"
                    creator_twitch_channel: null
                    income_30d: 900
                    income_90d: 2700
                    trend: flat
                    risk_score: 0.02
                    recommended_loan_amount: 3000
                    fraud_flags:
                      - "income_drop"
                    lender_ref: "LENDER-002"
                    created_at: "2026-02-19T12:00:00Z"
        '404':
          description: No verifications found for this creator
          content:
            application/json:
              schema:
                type: object
                properties:
                  creator_id:
                    type: integer
                  verifications:
                    type: array
                    items: {}
                  message:
                    type: string
              example:
                creator_id: 1
                verifications: []
                message: "No verifications found for this creator"

components:
  schemas:
    Creator:
      type: object
      properties:
        id:
          type: integer
        youtube_channel:
          type: string
          nullable: true
        twitch_channel:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    CreatorVerification:
      type: object
      properties:
        id:
          type: integer
        creator_id:
          type: integer
        creator_youtube_channel:
          type: string
          nullable: true
        creator_twitch_channel:
          type: string
          nullable: true
        income_30d:
          type: number
        income_90d:
          type: number
        trend:
          type: string
          enum:
            - growing
            - flat
        risk_score:
          type: number
        recommended_loan_amount:
          type: number
        fraud_flags:
          type: array
          items:
            type: string
        lender_ref:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
